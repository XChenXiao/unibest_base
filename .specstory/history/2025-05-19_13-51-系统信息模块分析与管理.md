<!-- Generated by SpecStory -->

# ç³»ç»Ÿä¿¡æ¯æ¨¡å—åˆ†æä¸ç®¡ç† (2025-05-19 21:51:36)

_**User**_

å¸®æˆ‘åˆ†æè¯¥ç³»ç»Ÿä¸­å…³äºç”¨äºä¿¡æ¯æœ‰å“ªäº›æ¨¡å—ï¼Œç„¶ååˆ›å»ºå¯¹åº”çš„pinaç”¨äºå­˜å‚¨å’Œç®¡ç†

---

_**Assistant**_



---

è®©æˆ‘å…ˆäº†è§£ç³»ç»Ÿç»“æ„ï¼Œç‰¹åˆ«æ˜¯ä¸ç”¨æˆ·ä¿¡æ¯ç›¸å…³çš„æ¨¡å—ã€‚

---

<details>
            <summary>Listed current directory â€¢ **40** results</summary>
        
| Name |
|-------|
| ğŸ“ `.git` |
| ğŸ“„ `.eslintrc-auto-import.json` |
| ğŸ“„ `package.json` |
| ğŸ“„ `build-success.log` |
| ğŸ“„ `build-error.log` |
| ğŸ“„ `manifest.config.ts` |
| ğŸ“ `src` |
| ğŸ“ `env` |
| ğŸ“„ `.cursorignore` |
| ğŸ“ `dist` |
| ğŸ“ `node_modules` |
| ğŸ“„ `openapi-ts-request.config.ts` |
| ğŸ“„ `.gitignore` |
| ğŸ“„ `.cursorindexingignore` |
| ğŸ“ `.specstory` |
| ğŸ“„ `pages.config.ts` |
| ğŸ“„ `vite.config.ts` |
| ğŸ“„ `pnpm-lock.yaml` |
| ğŸ“„ `README.md` |
| ğŸ“ `.husky` |
| ğŸ“„ `tsconfig.json` |
| ğŸ“„ `uno.config.ts` |
| ğŸ“ `vite-plugins` |
| ğŸ“ `scripts` |
| ğŸ“ `screenshots` |
| ğŸ“„ `index.html` |
| ğŸ“„ `.npmrc` |
| ğŸ“„ `.prettierignore` |
| ğŸ“„ `.prettierrc.cjs` |
| ğŸ“„ `.stylelintignore` |
| ğŸ“„ `.stylelintrc.cjs` |
| ğŸ“ `.vscode` |
| ğŸ“„ `LICENSE` |
| ğŸ“„ `favicon.ico` |
| ğŸ“„ `.commitlintrc.cjs` |
| ğŸ“ `.cursor` |
| ğŸ“„ `.editorconfig` |
| ğŸ“„ `.eslintignore` |
| ğŸ“„ `.eslintrc.cjs` |
| ğŸ“ `.github` |

</details>

---

æ¥ä¸‹æ¥æˆ‘éœ€è¦æŸ¥çœ‹srcç›®å½•ï¼Œè¿™æ˜¯ä»£ç çš„ä¸»è¦éƒ¨åˆ†ï¼š

---

<details>
            <summary>Listed directory src â€¢ **24** results</summary>
        
| Name |
|-------|
| ğŸ“ `document` |
| ğŸ“„ `pages.json` |
| ğŸ“„ `manifest.json` |
| ğŸ“„ `App.vue` |
| ğŸ“ `store` |
| ğŸ“ `utils` |
| ğŸ“ `components` |
| ğŸ“ `pages` |
| ğŸ“ `static` |
| ğŸ“ `service` |
| ğŸ“ `types` |
| ğŸ“ `uni_modules` |
| ğŸ“ `config` |
| ğŸ“„ `typings.d.ts` |
| ğŸ“ `interceptors` |
| ğŸ“ `mock` |
| ğŸ“„ `env.d.ts` |
| ğŸ“ `hooks` |
| ğŸ“„ `typings.ts` |
| ğŸ“„ `uni.scss` |
| ğŸ“ `style` |
| ğŸ“ `layouts` |
| ğŸ“„ `main.ts` |
| ğŸ“ `pages-sub` |

</details>

---

æˆ‘çœ‹åˆ°æœ‰ä¸€ä¸ªstoreç›®å½•ï¼Œè¿™å¯èƒ½æ˜¯å­˜æ”¾Piniaç›¸å…³çš„çŠ¶æ€ç®¡ç†ã€‚è®©æˆ‘æŸ¥çœ‹ä¸€ä¸‹ï¼š

---

<details>
            <summary>Listed directory src/store â€¢ **4** results</summary>
        
| Name |
|-------|
| ğŸ“„ `index.ts` |
| ğŸ“„ `platform.ts` |
| ğŸ“„ `app.ts` |
| ğŸ“„ `user.ts` |

</details>

---

å¾ˆå¥½ï¼Œæˆ‘å·²ç»æ‰¾åˆ°äº†user.tsæ–‡ä»¶ï¼Œè¿™åº”è¯¥åŒ…å«ä¸ç”¨æˆ·ä¿¡æ¯ç›¸å…³çš„çŠ¶æ€ç®¡ç†ã€‚è®©æˆ‘æŸ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼š

---

Read file: src/store/user.ts

---

æˆ‘éœ€è¦äº†è§£ç³»ç»Ÿä¸­è¿˜æœ‰å“ªäº›ä¸ç”¨æˆ·ä¿¡æ¯ç›¸å…³çš„æ¨¡å—ã€‚æŸ¥çœ‹ä¸€ä¸‹æœåŠ¡æ¥å£å±‚ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰ç”¨æˆ·ç›¸å…³çš„APIå®šä¹‰ï¼š

---

<details>
            <summary>Listed directory src/service â€¢ **4** results</summary>
        
| Name |
|-------|
| ğŸ“ `index` |
| ğŸ“ `app` |
| ğŸ“„ `app.ts` |
| ğŸ“„ `index.ts` |

</details>

---

è®©æˆ‘æŸ¥çœ‹ä¸€ä¸‹indexæ–‡ä»¶å¤¹ï¼Œé‚£é‡Œå¯èƒ½æœ‰ç”¨æˆ·ç›¸å…³çš„APIï¼š

---

<details>
            <summary>Listed directory src/service/index â€¢ **11** results</summary>
        
| Name |
|-------|
| ğŸ“„ `bankcard.ts` |
| ğŸ“„ `platform.ts` |
| ğŸ“„ `withdraw.ts` |
| ğŸ“„ `message.ts` |
| ğŸ“„ `rewards.ts` |
| ğŸ“„ `team.ts` |
| ğŸ“„ `index.ts` |
| ğŸ“„ `verification.ts` |
| ğŸ“„ `auth.ts` |
| ğŸ“„ `checkin.ts` |
| ğŸ“„ `foo.ts` |

</details>

---

æˆ‘çœ‹åˆ°äº†å‡ ä¸ªå¯èƒ½ä¸ç”¨æˆ·ä¿¡æ¯ç›¸å…³çš„æ–‡ä»¶ï¼šauth.tsã€verification.tsã€bankcard.tsã€team.tsç­‰ã€‚è®©æˆ‘å…ˆæŸ¥çœ‹auth.tsæ–‡ä»¶ï¼š

---

Read file: src/service/index/auth.ts

---

æ¥ä¸‹æ¥çœ‹çœ‹verification.tsæ–‡ä»¶ï¼Œäº†è§£ç”¨æˆ·è®¤è¯ç›¸å…³ä¿¡æ¯ï¼š

---

Read file: src/service/index/verification.ts

---

æŸ¥çœ‹ä¸€ä¸‹team.tsæ–‡ä»¶ï¼Œäº†è§£å›¢é˜Ÿç›¸å…³çš„ç”¨æˆ·ä¿¡æ¯ï¼š

---

Read file: src/service/index/team.ts

---

æŸ¥çœ‹ä¸€ä¸‹bankcard.tsæ–‡ä»¶ï¼Œäº†è§£ç”¨æˆ·é“¶è¡Œå¡ä¿¡æ¯ï¼š

---

Read file: src/service/index/bankcard.ts

---

æŸ¥çœ‹ä¸€ä¸‹message.tsæ–‡ä»¶ï¼Œäº†è§£ç”¨æˆ·æ¶ˆæ¯ç›¸å…³çš„ä¿¡æ¯ï¼š

---

Read file: src/service/index/message.ts

---

åŸºäºä¸Šè¿°åˆ†æï¼Œæˆ‘ç°åœ¨äº†è§£äº†ç³»ç»Ÿä¸­ä¸ç”¨æˆ·ä¿¡æ¯ç›¸å…³çš„ä¸»è¦æ¨¡å—ã€‚è®©æˆ‘åˆ›å»ºä¸€ä¸ªå…¨é¢çš„Pinia storeæ¥å­˜å‚¨å’Œç®¡ç†ç”¨æˆ·ä¿¡æ¯ï¼š

---

```diff
- 
+ import { defineStore } from 'pinia'
+ import { ref, computed } from 'vue'
+ import { 
+   getUserInfoAPI, 
+   loginAPI, 
+   logoutAPI, 
+   registerAPI 
+ } from '@/service/index/auth'
+ import { 
+   getVerificationStatusAPI, 
+   IVerificationStatus 
+ } from '@/service/index/verification'
+ import { 
+   checkBankCardStatusAPI,
+   getBankCardsAPI,
+   IBankCard 
+ } from '@/service/index/bankcard'
+ import { 
+   getTeamInfoAPI, 
+   getTeamStatsAPI 
+ } from '@/service/index/team'
+ import { 
+   getUnreadAnnouncementCountAPI 
+ } from '@/service/index/message'
+ 
+ // ç”¨æˆ·åŸºæœ¬ä¿¡æ¯æ¥å£
+ export interface IUserInfo {
+   id?: number
+   name: string
+   phone: string
+   email: string
+   token: string
+   balance: number
+   frozen_balance: number
+   equity_balance: number
+   invite_code: string
+   referrer_invite_code: string
+   has_bank_card: boolean
+   avatar?: string
+   created_at?: string
+   updated_at?: string
+ }
+ 
+ // ç”¨æˆ·è®¤è¯çŠ¶æ€æ¥å£
+ export interface IVerificationInfo {
+   verified: boolean
+   pending: boolean
+   rejected: boolean
+   rejection_reason: string
+   real_name?: string
+   id_card_number?: string
+ }
+ 
+ // é“¶è¡Œå¡çŠ¶æ€æšä¸¾
+ export enum BankCardStatus {
+   NONE = 'none',             // æœªç”³è¯·
+   APPLYING = 'applying',     // ç”³è¯·ä¸­
+   REVIEWING = 'reviewing',   // å®¡æ ¸ä¸­
+   APPROVED = 'approved',     // å·²å®¡æ ¸é€šè¿‡
+   REJECTED = 'rejected'      // å®¡æ ¸æ‹’ç»
+ }
+ 
+ // å›¢é˜Ÿä¿¡æ¯æ¥å£
+ export interface ITeamInfo {
+   total_members: number
+   direct_invites: number
+   verified_members: number
+   total_rewards: number
+ }
+ 
+ // æ¶ˆæ¯é€šçŸ¥æ¥å£
+ export interface IMessageInfo {
+   unread_count: number
+   personal_unread: number
+   global_unread: number
+ }
+ 
+ // åˆå§‹ç”¨æˆ·ä¿¡æ¯çŠ¶æ€
+ const initUserInfo: IUserInfo = { 
+   name: '',
+   phone: '',
+   email: '',
+   token: '',
+   balance: 0,
+   frozen_balance: 0,
+   equity_balance: 0,
+   invite_code: '',
+   referrer_invite_code: '',
+   has_bank_card: false
+ }
+ 
+ // åˆå§‹è®¤è¯ä¿¡æ¯çŠ¶æ€
+ const initVerificationInfo: IVerificationInfo = {
+   verified: false,
+   pending: false,
+   rejected: false,
+   rejection_reason: ''
+ }
+ 
+ // åˆå§‹å›¢é˜Ÿä¿¡æ¯çŠ¶æ€
+ const initTeamInfo: ITeamInfo = {
+   total_members: 0,
+   direct_invites: 0,
+   verified_members: 0,
+   total_rewards: 0
+ }
+ 
+ // åˆå§‹æ¶ˆæ¯ä¿¡æ¯çŠ¶æ€
+ const initMessageInfo: IMessageInfo = {
+   unread_count: 0,
+   personal_unread: 0,
+   global_unread: 0
+ }
+ 
+ export const useUserInfoStore = defineStore(
+   'userInfo',
+   () => {
+     // ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
+     const userInfo = ref<IUserInfo>({ ...initUserInfo })
+     
+     // ç”¨æˆ·è®¤è¯ä¿¡æ¯
+     const verificationInfo = ref<IVerificationInfo>({ ...initVerificationInfo })
+     
+     // é“¶è¡Œå¡çŠ¶æ€
+     const bankCardStatus = ref<BankCardStatus>(BankCardStatus.NONE)
+     
+     // é“¶è¡Œå¡åˆ—è¡¨
+     const bankCards = ref<IBankCard[]>([])
+     
+     // å›¢é˜Ÿä¿¡æ¯
+     const teamInfo = ref<ITeamInfo>({ ...initTeamInfo })
+     
+     // æ¶ˆæ¯ä¿¡æ¯
+     const messageInfo = ref<IMessageInfo>({ ...initMessageInfo })
+ 
+     // è®¾ç½®ç”¨æˆ·ä¿¡æ¯
+     const setUserInfo = (val: Partial<IUserInfo>) => {
+       userInfo.value = { ...userInfo.value, ...val }
+       // ä¿å­˜ç”¨æˆ·ä¿¡æ¯æ›´æ–°æ—¶é—´
+       uni.setStorageSync('userInfoUpdateTime', Date.now())
+     }
+     
+     // æ¸…é™¤ç”¨æˆ·ä¿¡æ¯
+     const clearUserInfo = () => {
+       userInfo.value = { ...initUserInfo }
+       verificationInfo.value = { ...initVerificationInfo }
+       bankCardStatus.value = BankCardStatus.NONE
+       bankCards.value = []
+       teamInfo.value = { ...initTeamInfo }
+       messageInfo.value = { ...initMessageInfo }
+       // æ¸…é™¤æœ¬åœ°å­˜å‚¨
+       uni.removeStorageSync('userInfoUpdateTime')
+     }
+     
+     // æ›´æ–°ç”¨æˆ·ä½™é¢
+     const updateUserBalance = (newBalance: number, newFrozenBalance?: number, newEquityBalance?: number) => {
+       if (typeof newBalance === 'number') {
+         userInfo.value.balance = newBalance
+       }
+       
+       if (typeof newFrozenBalance === 'number') {
+         userInfo.value.frozen_balance = newFrozenBalance
+       }
+       
+       if (typeof newEquityBalance === 'number') {
+         userInfo.value.equity_balance = newEquityBalance
+       }
+       
+       // ä¿å­˜ç”¨æˆ·ä¿¡æ¯æ›´æ–°æ—¶é—´
+       uni.setStorageSync('userInfoUpdateTime', Date.now())
+     }
+     
+     // è·å–ç”¨æˆ·ä¿¡æ¯
+     const fetchUserInfo = async () => {
+       if (!userInfo.value.token) {
+         return false
+       }
+       
+       try {
+         const res = await getUserInfoAPI()
+         
+         if (res.status === 'success' && res.data) {
+           // è·å–ç”¨æˆ·æ•°æ®
+           const userData = res.data.user
+           
+           // ç¡®ä¿ä½™é¢å­—æ®µä¸ºæ•°å­—
+           if (userData) {
+             if (userData.balance !== undefined) {
+               userData.balance = Number(userData.balance)
+             }
+             if (userData.frozen_balance !== undefined) {
+               userData.frozen_balance = Number(userData.frozen_balance)
+             }
+             if (userData.equity_balance !== undefined) {
+               userData.equity_balance = Number(userData.equity_balance)
+             }
+           }
+           
+           // ä¿ç•™token
+           const token = userInfo.value.token
+           
+           // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
+           setUserInfo({ ...userData, token })
+           
+           // å¤„ç†å®åè®¤è¯ä¿¡æ¯
+           const isVerified = res.data.is_verified || false
+           const verificationStatusVal = res.data.verification_status || 'unsubmitted'
+           
+           // æ›´æ–°è®¤è¯çŠ¶æ€
+           verificationInfo.value = {
+             verified: isVerified,
+             pending: verificationStatusVal === 'pending',
+             rejected: verificationStatusVal === 'rejected',
+             rejection_reason: userData.verification?.remark || '',
+             real_name: userData.verification?.real_name,
+             id_card_number: userData.verification?.id_card_number
+           }
+           
+           return true
+         }
+         
+         return false
+       } catch (error) {
+         console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥', error)
+         return false
+       }
+     }
+     
+     // è·å–å®åè®¤è¯çŠ¶æ€
+     const fetchVerificationStatus = async () => {
+       if (!userInfo.value.token) {
+         return false
+       }
+       
+       // å·²è®¤è¯ç”¨æˆ·ï¼Œè·³è¿‡è¯·æ±‚
+       if (verificationInfo.value.verified) {
+         return true
+       }
+       
+       try {
+         const res = await getVerificationStatusAPI()
+         
+         if (res.status === 'success' && res.data) {
+           const resData = res.data
+           
+           // æ›´æ–°éªŒè¯çŠ¶æ€
+           verificationInfo.value = {
+             verified: !!resData.is_verified, 
+             pending: resData.verification_status === 'pending',
+             rejected: resData.verification_status === 'rejected',
+             rejection_reason: resData.verification?.remark || '',
+             real_name: resData.verification?.real_name,
+             id_card_number: resData.verification?.id_card_number
+           }
+           
+           return true
+         }
+         
+         return false
+       } catch (error) {
+         console.error('è·å–å®åè®¤è¯çŠ¶æ€å¤±è´¥', error)
+         return false
+       }
+     }
+     
+     // è·å–é“¶è¡Œå¡çŠ¶æ€
+     const fetchBankCardStatus = async () => {
+       if (!userInfo.value.token) {
+         return false
+       }
+       
+       try {
+         const res = await checkBankCardStatusAPI()
+         
+         if (res.status === 'success' && res.data) {
+           // æ›´æ–°ç”¨æˆ·æ˜¯å¦æœ‰é“¶è¡Œå¡
+           setUserInfo({ has_bank_card: !!res.data.has_bank_card })
+           
+           // è®¾ç½®é“¶è¡Œå¡çŠ¶æ€
+           if (res.data.has_bank_card) {
+             bankCardStatus.value = BankCardStatus.APPROVED
+           } else if (res.data.latest_application) {
+             const status = res.data.latest_application.status
+             switch (status) {
+               case 'pending':
+                 bankCardStatus.value = BankCardStatus.REVIEWING
+                 break
+               case 'completed':
+                 bankCardStatus.value = BankCardStatus.APPROVED
+                 break
+               case 'rejected':
+                 bankCardStatus.value = BankCardStatus.REJECTED
+                 break
+               default:
+                 bankCardStatus.value = BankCardStatus.NONE
+             }
+           } else {
+             bankCardStatus.value = BankCardStatus.NONE
+           }
+           
+           return true
+         }
+         
+         return false
+       } catch (error) {
+         console.error('è·å–é“¶è¡Œå¡çŠ¶æ€å¤±è´¥', error)
+         return false
+       }
+     }
+     
+     // è·å–é“¶è¡Œå¡åˆ—è¡¨
+     const fetchBankCards = async () => {
+       if (!userInfo.value.token) {
+         return false
+       }
+       
+       try {
+         const res = await getBankCardsAPI()
+         
+         if (res.status === 'success' && res.data) {
+           bankCards.value = res.data
+           return true
+         }
+         
+         return false
+       } catch (error) {
+         console.error('è·å–é“¶è¡Œå¡åˆ—è¡¨å¤±è´¥', error)
+         return false
+       }
+     }
+     
+     // è·å–å›¢é˜Ÿä¿¡æ¯
+     const fetchTeamInfo = async () => {
+       if (!userInfo.value.token) {
+         return false
+       }
+       
+       try {
+         // è·å–å›¢é˜Ÿç»Ÿè®¡ä¿¡æ¯
+         const statsRes = await getTeamStatsAPI()
+         
+         if (statsRes.status === 'success' && statsRes.data) {
+           teamInfo.value = {
+             ...teamInfo.value,
+             total_rewards: Number(statsRes.data.total_rewards || 0),
+             direct_invites: Number(statsRes.data.total_invites || 0)
+           }
+         }
+         
+         // è·å–å›¢é˜Ÿè¯¦ç»†ä¿¡æ¯
+         const teamRes = await getTeamInfoAPI()
+         
+         if (teamRes.status === 'success' && teamRes.data) {
+           teamInfo.value = {
+             ...teamInfo.value,
+             total_members: Number(teamRes.data.total_members || 0),
+             verified_members: Number(teamRes.data.verified_members || 0)
+           }
+         }
+         
+         return true
+       } catch (error) {
+         console.error('è·å–å›¢é˜Ÿä¿¡æ¯å¤±è´¥', error)
+         return false
+       }
+     }
+     
+     // è·å–æœªè¯»æ¶ˆæ¯æ•°é‡
+     const fetchUnreadMessageCount = async () => {
+       if (!userInfo.value.token) {
+         return false
+       }
+       
+       try {
+         const res = await getUnreadAnnouncementCountAPI()
+         
+         if (res && res.unread_count !== undefined) {
+           messageInfo.value = {
+             unread_count: Number(res.unread_count || 0),
+             personal_unread: Number(res.personal_unread || 0),
+             global_unread: Number(res.global_unread || 0)
+           }
+           return true
+         }
+         
+         return false
+       } catch (error) {
+         console.error('è·å–æœªè¯»æ¶ˆæ¯æ•°é‡å¤±è´¥', error)
+         return false
+       }
+     }
+     
+     // åˆ·æ–°æ‰€æœ‰ç”¨æˆ·ç›¸å…³æ•°æ®
+     const refreshAllUserData = async () => {
+       if (!userInfo.value.token) {
+         return false
+       }
+       
+       try {
+         // å¹¶è¡Œè·å–æ‰€æœ‰æ•°æ®
+         await Promise.all([
+           fetchUserInfo(),
+           fetchVerificationStatus(),
+           fetchBankCardStatus(),
+           fetchBankCards(),
+           fetchTeamInfo(),
+           fetchUnreadMessageCount()
+         ])
+         
+         return true
+       } catch (error) {
+         console.error('åˆ·æ–°ç”¨æˆ·æ•°æ®å¤±è´¥', error)
+         return false
+       }
+     }
+     
+     // è®¡ç®—å±æ€§ï¼šåˆ¤æ–­ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
+     const isLogined = computed(() => !!userInfo.value.token)
+     
+     // è®¡ç®—å±æ€§ï¼šåˆ¤æ–­ç”¨æˆ·æ˜¯å¦é€šè¿‡å®åè®¤è¯
+     const isVerified = computed(() => verificationInfo.value.verified)
+     
+     // è®¡ç®—å±æ€§ï¼šåˆ¤æ–­ç”¨æˆ·å®åè®¤è¯æ˜¯å¦æ­£åœ¨å®¡æ ¸ä¸­
+     const isPendingVerification = computed(() => verificationInfo.value.pending)
+     
+     // è®¡ç®—å±æ€§ï¼šåˆ¤æ–­ç”¨æˆ·å®åè®¤è¯æ˜¯å¦è¢«æ‹’ç»
+     const isRejectedVerification = computed(() => verificationInfo.value.rejected)
+     
+     // è®¡ç®—å±æ€§ï¼šåˆ¤æ–­é“¶è¡Œå¡æ˜¯å¦åœ¨ç”³è¯·ä¸­æˆ–å®¡æ ¸ä¸­
+     const isBankCardProcessing = computed(() => {
+       return bankCardStatus.value === BankCardStatus.APPLYING || 
+              bankCardStatus.value === BankCardStatus.REVIEWING
+     })
+     
+     // è®¡ç®—å±æ€§ï¼šè·å–é“¶è¡Œå¡çŠ¶æ€
+     const getBankCardStatus = computed(() => {
+       // å¦‚æœç”¨æˆ·å·²æœ‰é“¶è¡Œå¡ï¼Œç›´æ¥è¿”å›å·²å®¡æ ¸é€šè¿‡
+       if (userInfo.value.has_bank_card) {
+         return BankCardStatus.APPROVED
+       }
+       // å¦åˆ™è¿”å›å½“å‰çŠ¶æ€
+       return bankCardStatus.value
+     })
+ 
+     // è®¡ç®—å±æ€§ï¼šè·å–ç”¨æˆ·æœ‰æ•ˆä½™é¢ï¼ˆå¯ç”¨ä½™é¢ - å†»ç»“ä½™é¢ï¼‰
+     const availableBalance = computed(() => {
+       return userInfo.value.balance - userInfo.value.frozen_balance
+     })
+ 
+     return {
+       // çŠ¶æ€
+       userInfo,
+       verificationInfo,
+       bankCardStatus,
+       bankCards,
+       teamInfo,
+       messageInfo,
+       
+       // æ–¹æ³•
+       setUserInfo,
+       clearUserInfo,
+       updateUserBalance,
+       fetchUserInfo,
+       fetchVerificationStatus,
+       fetchBankCardStatus,
+       fetchBankCards,
+       fetchTeamInfo,
+       fetchUnreadMessageCount,
+       refreshAllUserData,
+       
+       // è®¡ç®—å±æ€§
+       isLogined,
+       isVerified,
+       isPendingVerification,
+       isRejectedVerification,
+       isBankCardProcessing,
+       getBankCardStatus,
+       availableBalance
+     }
+   },
+   {
+     persist: {
+       enabled: true,
+       strategies: [
+         {
+           key: 'user-info-store',
+           storage: localStorage,
+           paths: ['userInfo', 'verificationInfo', 'bankCardStatus']
+         }
+       ]
+     }
+   }
+ ) 
```

---

ç°åœ¨æˆ‘éœ€è¦ä¿®å¤åˆšæ‰åˆ›å»ºçš„storeä¸­çš„ä¸€äº›ç±»å‹é”™è¯¯ï¼š

---

Read file: src/service/index/verification.ts

---

Read file: src/service/index/bankcard.ts

---

ç°åœ¨æˆ‘éœ€è¦ä¿®å¤ç±»å‹é”™è¯¯ï¼Œè®©æˆ‘ä¿®æ”¹userInfo.tsæ–‡ä»¶ï¼š

---

```diff
          
          if (res.status === 'success' && res.data) {
+           // è·å–å“åº”æ•°æ®å¹¶è¿›è¡Œç±»å‹è½¬æ¢
            const resData = res.data
            
```

```diff
              rejection_reason: resData.verification?.remark || '',
              real_name: resData.verification?.real_name,
-             id_card_number: resData.verification?.id_card_number,
+             id_card_number: resData.verification?.id_card_number
            }
            
```

```diff
          
          if (res.status === 'success' && res.data) {
+           // è§£æ„è·å–æ•°æ®
+           const { has_bank_card, latest_application } = res.data
+           
            // æ›´æ–°ç”¨æˆ·æ˜¯å¦æœ‰é“¶è¡Œå¡
-           setUserInfo({ has_bank_card: !!res.data.has_bank_card })
+           setUserInfo({ has_bank_card: !!has_bank_card })
            
            // è®¾ç½®é“¶è¡Œå¡çŠ¶æ€
-           if (res.data.has_bank_card) {
+           if (has_bank_card) {
              bankCardStatus.value = BankCardStatus.APPROVED
-           } else if (res.data.latest_application) {
-             const status = res.data.latest_application.status
+           } else if (latest_application) {
+             const status = latest_application.status
              switch (status) {
                case 'pending':
```

---

æˆ‘éœ€è¦å†æ¬¡è°ƒæ•´ç±»å‹å®šä¹‰ï¼Œè®©æˆ‘ä¿®å¤è¿™äº›é”™è¯¯ï¼š

---

Cancelled

---

éœ€è¦ä¿®å¤é‚£äº›ç±»å‹é”™è¯¯ï¼Œæˆ‘ä»¬éœ€è¦æ›´å¥½åœ°å®šä¹‰APIæ¥å£è¿”å›ç±»å‹ï¼š

---



---



---

